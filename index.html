<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tharindu - Portfolio</title>
  
  <!-- Prevent ALL caching -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <link rel="stylesheet" href="assets/css/style.css?v=<?php echo time(); ?>">
  <meta name="theme-color" content="#10b981">
  <link rel="icon" href="assets/icons/icon-192.png" sizes="192x192">
  <link rel="icon" href="assets/icons/icon-512.png" sizes="512x512">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
</head>
<body>
  <script>
    // Unregister ALL service workers immediately
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
    
    // Clear ALL browser caches
    if ('caches' in window) {
      caches.keys().then(function(names) {
        for (let name of names) caches.delete(name);
      });
    }
    
    // Force reload on browser back button
    window.addEventListener('pageshow', function(event) {
      if (event.persisted) {
        window.location.reload();
      }
    });
  </script>

  <!-- floating language switcher -->
  <div class="language-switcher" id="langBox" aria-label="Language switcher">
    <button class="lang-btn active" id="langEn">EN</button>
    <button class="lang-btn" id="langSi">සිං</button>
  </div>

  <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
  <div class="overlay" id="overlay"></div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-avatar">
        <img src="assets/icons/profile.jpg?v=<?php echo time(); ?>" alt="Profile" class="avatar-img">
      </div>
    
      <h2 class="sidebar-name" id="sidebar-name">Tharindu</h2>
      <p class="sidebar-tagline" id="sidebar-tagline">Web Developer & Designer</p>
    </div>
    
    <nav class="sidebar-nav">
      <a href="index.html" class="nav-item active"><i class="fas fa-folder-open"></i><span id="nav-projects">Projects</span></a>
      <a href="contact.html" class="nav-item"><i class="fas fa-paper-plane"></i><span id="nav-contact">Contact</span></a>
    </nav>
  </aside>

  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title" id="page-title">My Projects</h1>
      <p class="page-subtitle" id="page-subtitle">A collection of my recent work and projects</p>
    </div>

    <!-- projects grid is built dynamically -->
    <div class="projects-grid" id="projectsGrid"></div>

    <footer><p id="footer-text">© 2025 Tharindu. All rights reserved.</p></footer>
  </main>

  <!-- app scripts with timestamp to bust cache -->
  <script type="module" src="assets/js/main.js?v=<?php echo time(); ?>"></script>
  <script>
    // Alternative if not using PHP - use Date.now()
    if (!document.querySelector('script[src*="time()"]')) {
      const timestamp = Date.now();
      document.querySelectorAll('link[rel="stylesheet"], script[src*=".js"]').forEach(el => {
        if (el.tagName === 'LINK') {
          el.href = el.href.split('?')[0] + '?v=' + timestamp;
        } else if (el.tagName === 'SCRIPT' && el.src) {
          el.src = el.src.split('?')[0] + '?v=' + timestamp;
        }
      });
    }
  </script>
</body>
</html>